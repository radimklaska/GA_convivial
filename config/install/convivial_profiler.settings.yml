site_id: convivial-demo
license_key: community
client_cleanup: true
event_tracking: true
profilers:
  set:
    name: set
    label: Set
    weight: -17
    status: true
    description: 'Checks set query parameter and saves to storage.'
    deferred: false
    sources:
      -
        type: query
        param: set
    processors:
      -
        type: temp
        storage_key: set
    destinations:
      -
        type: set
        storage_key: temp.set.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  unset:
    name: unset
    label: Unset
    weight: -16
    status: true
    description: 'Checks unset query parameter and unset it from storage.'
    deferred: false
    sources:
      -
        type: query
        param: unset
    processors:
      -
        type: temp
        storage_key: unset
    destinations:
      -
        type: unset
        storage_key: temp.unset.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  remove:
    name: remove
    label: Remove
    weight: -15
    status: true
    description: 'Checks remove query parameter and remove it from storage.'
    deferred: false
    sources:
      -
        type: query
        param: remove
    processors:
      -
        type: temp
        storage_key: remove
    destinations:
      -
        type: remove
        storage_keys:
          - temp.remove.value
        static_values:
          - ''
        target_location:
          localstorage: localstorage
          cookie: '0'
  utm_campaign:
    name: utm_campaign
    label: 'UTM campaign'
    weight: -14
    status: true
    description: 'Checks utm_campaign query parameter and set dataLayer event and saves to storage.'
    deferred: false
    sources:
      -
        type: query
        param: utm_campaign
    processors:
      -
        type: store
        storage_key: utm_campaign
        ttl: 300
    destinations:
      -
        type: datalayer_event
        category: campaign
        action: view
        normalize: true
      -
        type: copy
        target_key: campaign_utm
        remove_empty: true
        storage_key: store.utm_campaign.value
        stringify: false
        target_location:
          localstorage: localstorage
          cookie: '0'
  utm_source:
    name: utm_source
    label: 'UTM source'
    weight: -13
    status: true
    description: 'Checks utm_source query parameter and saves to storage.'
    deferred: false
    sources:
      -
        type: query
        param: utm_source
    processors:
      -
        type: store
        storage_key: utm_source
        ttl: 300
    destinations:
      -
        type: copy
        target_key: utm_source
        remove_empty: true
        storage_key: store.utm_source.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  utm_medium:
    name: utm_medium
    label: 'UTM medium'
    weight: -12
    status: true
    description: 'Checks utm_medium query parameter and saves to storage.'
    deferred: false
    sources:
      -
        type: query
        param: utm_medium
    processors:
      -
        type: store
        storage_key: utm_medium
        ttl: 300
    destinations:
      -
        type: copy
        target_key: utm_medium
        remove_empty: true
        storage_key: store.utm_medium.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  hour:
    name: hour
    label: Hour
    weight: -11
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: time
        part: hour
    processors:
      -
        type: store
        storage_key: hour
        ttl: 3600
    destinations:
      -
        type: range
        target_key: daytime
        remove_empty: false
        storage_key: store.hour.value
        ranges:
          -
            key: 'daytime:morning'
            min: 6
            max: 12
          -
            key: 'daytime:afternoon'
            min: 12
            max: 17
          -
            key: 'daytime:evening'
            min: 17
            max: 21
          -
            key: 'daytime:night'
            min: 0
            max: 6
          -
            key: 'daytime:night'
            min: 21
            max: 24
        target_location:
          localstorage: localstorage
          cookie: '0'
      -
        type: copy
        target_key: hour
        remove_empty: true
        storage_key: store.hour.value
        stringify: false
        target_location:
          localstorage: localstorage
          cookie: '0'
  author:
    name: author
    label: Author
    weight: -10
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: meta
        attribute_name: author
    processors:
      -
        type: dimension
        storage_key: author
        normalize: true
    destinations:
      -
        type: datalayer_event
        category: author
        action: view
        normalize: true
  type:
    name: type
    label: Type
    weight: -9
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: meta
        attribute_name: type
    processors:
      -
        type: dimension
        storage_key: type
        normalize: true
    destinations:
      -
        type: datalayer_event
        category: type
        action: view
        normalize: true
      -
        type: top
        target_key: type_top
        remove_empty: false
        dimension_key: dimensions.type
        target_location:
          localstorage: localstorage
          cookie: '0'
  audience:
    name: audience
    label: Audience
    weight: -8
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: meta
        attribute_name: audience
    processors:
      -
        type: dimension
        storage_key: audience
        normalize: true
    destinations:
      -
        type: datalayer_event
        category: audience
        action: view
        normalize: true
      -
        type: top
        target_key: audience_top
        remove_empty: false
        dimension_key: dimensions.audience
        target_location:
          localstorage: localstorage
          cookie: '0'
  audience_crm:
    name: audience_crm
    label: 'Audience crm'
    weight: -7
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: cookie
        name: convivial_enricher_convivial_demo_audience
    processors:
      -
        type: store
        storage_key: audience_crm
        ttl: 300
    destinations:
      -
        type: copy
        target_key: audience_crm
        remove_empty: true
        storage_key: store.audience_crm.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  audience_affinity:
    name: audience_affinity
    label: 'Audience affinity'
    weight: -6
    status: true
    description: ''
    deferred: false
    sources: {  }
    processors: {  }
    destinations:
      -
        type: bestpick
        target_key: audience_affinity
        remove_empty: true
        storage_keys:
          - audience_crm
          - audience_top
        default_value: 'audience:general'
        target_location:
          localstorage: localstorage
          cookie: '0'
  campaign_crm:
    name: campaign_crm
    label: 'Campaign crm'
    weight: -5
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: cookie
        name: convivial_enricher_convivial_demo_campaign
    processors:
      -
        type: store
        storage_key: campaign_crm
        ttl: 300
    destinations:
      -
        type: copy
        target_key: campaign_crm
        remove_empty: true
        storage_key: store.campaign_crm.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  campaign_affinity:
    name: campaign_affinity
    label: 'Campaign affinity'
    weight: -4
    status: true
    description: ''
    deferred: false
    sources: {  }
    processors: {  }
    destinations:
      -
        type: bestpick
        target_key: campaign_affinity
        remove_empty: true
        storage_keys:
          - campaign_crm
          - campaign_utm
        default_value: ''
        target_location:
          localstorage: localstorage
          cookie: '0'
  topic:
    name: topic
    label: Topic
    weight: -3
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: meta
        attribute_name: topic
    processors:
      -
        type: dimension
        storage_key: topic
        normalize: true
    destinations:
      -
        type: datalayer_event
        category: topic
        action: view
        normalize: true
      -
        type: top
        target_key: topic_top
        remove_empty: false
        dimension_key: dimensions.topic
        target_location:
          localstorage: localstorage
          cookie: '0'
  topic_crm:
    name: topic_crm
    label: 'Topic crm'
    weight: -2
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: cookie
        name: convivial_enricher_convivial_demo_topic
    processors:
      -
        type: store
        storage_key: topic_crm
        ttl: 300
    destinations:
      -
        type: copy
        target_key: topic_crm
        remove_empty: true
        storage_key: store.topic_crm.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  topic_decision_tree:
    name: topic_decision_tree
    label: 'Topic decision tree'
    weight: -1
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: cookie
        name: decision_tree_outcome_84
    processors:
      -
        type: store
        storage_key: topic_decision_tree
        ttl: 300
    destinations:
      -
        type: copy
        target_key: topic_decision_tree
        remove_empty: true
        storage_key: store.topic_decision_tree.value
        target_location:
          localstorage: localstorage
          cookie: '0'
      -
        type: remove
        storage_keys:
          - store.topic_decision_tree.value
        static_values:
          - decision_tree_outcome_84
        target_location:
          localstorage: '0'
          cookie: cookie
  topic_affinity:
    name: topic_affinity
    label: 'Topic affinity'
    weight: 0
    status: true
    description: ''
    deferred: false
    sources: {  }
    processors: {  }
    destinations:
      -
        type: bestpick
        target_key: topic_affinity
        remove_empty: true
        storage_keys:
          - topic_crm
          - topic_decision_tree
          - topic_top
        default_value: 'topic:general'
        target_location:
          localstorage: localstorage
          cookie: '0'
  lifetime_value:
    name: lifetime_value
    label: 'Lifetime Value'
    weight: 1
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: meta
        attribute_name: price
    processors:
      -
        type: accumulation
        storage_key: lifetime_value
    destinations:
      -
        type: copy
        target_key: lifetime_value
        remove_empty: false
        storage_key: accumulators.lifetime_value
        target_location:
          localstorage: localstorage
          cookie: '0'
  goal:
    name: goal
    label: Goal
    weight: 2
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: meta
        attribute_name: goal
    processors:
      -
        type: store
        storage_key: goal
        ttl: -1
    destinations:
      -
        type: flag
        storage_key: store.goal.value
        target_location:
          localstorage: localstorage
          cookie: '0'
        flag_prefix: ''
        flag_suffix: ':on'
  device_type:
    name: device_type
    label: 'Device type'
    weight: 3
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: httpuseragent
        key: navigator.userAgent
    processors:
      -
        type: store
        storage_key: device_type
        ttl: -1
    destinations:
      -
        type: copy
        target_key: device_type
        remove_empty: false
        storage_key: store.device_type.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  location_country:
    name: location_country
    label: 'Location country'
    weight: 4
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: cookie
        name: cp_country
    processors:
      -
        type: store
        storage_key: location_country
        ttl: -1
      -
        type: map
        storage_key: location_zone
        default_value: 'zone:australia'
        fallback_value: 'zone:international'
        mappings:
          - 'Australia|zone:australia'
          - 'AU|zone:australia'
    destinations:
      -
        type: copy
        target_key: location_country
        remove_empty: false
        storage_key: store.location_country.value
        target_location:
          localstorage: localstorage
          cookie: '0'
      -
        type: copy
        target_key: location_zone
        remove_empty: true
        storage_key: store.location_zone.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  location_lat:
    name: location_lat
    label: 'Location latitude'
    weight: 5
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: cookie
        name: cp_latitude
    processors:
      -
        type: store
        storage_key: location_lat
        ttl: -1
    destinations:
      -
        type: season
        target_key: season
        remove_empty: false
        storage_key: store.location_lat.value
        target_location:
          localstorage: localstorage
          cookie: '0'
      -
        type: copy
        target_key: location_lat
        remove_empty: false
        storage_key: store.location_lat.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  location_lon:
    name: location_lon
    label: 'Location longitude'
    weight: 6
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: cookie
        name: cp_longitude
    processors:
      -
        type: store
        storage_key: location_lon
        ttl: -1
    destinations:
      -
        type: copy
        target_key: location_lon
        remove_empty: false
        storage_key: store.location_lon.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  location_city:
    name: location_city
    label: 'Location city'
    weight: 7
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: cookie
        name: cp_city
    processors:
      -
        type: store
        storage_key: location_city
        ttl: -1
    destinations:
      -
        type: copy
        target_key: location_city
        remove_empty: false
        storage_key: store.location_city.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  pageview:
    name: pageview
    label: Pageview
    weight: 8
    status: true
    description: ''
    deferred: false
    sources: {  }
    processors:
      -
        type: pageview
        storage_key: pageview
        track: true
        log: false
    destinations:
      -
        type: copy
        target_key: visits
        remove_empty: false
        storage_key: counters.pageview
        target_location:
          localstorage: localstorage
          cookie: '0'
      -
        type: range
        target_key: experience
        remove_empty: false
        storage_key: counters.pageview
        ranges:
          -
            key: 'experience:none'
            min: 0
            max: 2
          -
            key: 'experience:low'
            min: 2
            max: 10
          -
            key: 'experience:medium'
            min: 10
            max: 100
          -
            key: 'experience:high'
            min: 100
            max: 1000000
        target_location:
          localstorage: localstorage
          cookie: '0'
  searchquery:
    name: searchquery
    label: Searchquery
    weight: 9
    status: true
    description: ''
    deferred: false
    sources: {  }
    processors:
      -
        type: searchquery
        storage_key: searchquery
        search_path: /search
        query_param: keys
        exclude_param: page
        size: 5
        track: false
        log: true
    destinations:
      -
        type: copy
        target_key: cp_search_log
        remove_empty: false
        storage_key: log.searchquery
        stringify: true
        target_location:
          localstorage: localstorage
          cookie: '0'
  language:
    name: language
    label: Language
    weight: 10
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: acceptlang
        key: navigator.language
    processors:
      -
        type: language_simple
        storage_key: language-simple
        ttl: -1
      -
        type: language_full
        storage_key: language-full
        ttl: -1
    destinations:
      -
        type: copy
        target_key: language
        remove_empty: false
        storage_key: store.language-full.value
        target_location:
          localstorage: localstorage
          cookie: '0'
  stage:
    name: stage
    label: Stage
    weight: 11
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: meta
        attribute_name: stage
    processors:
      -
        type: dimension
        storage_key: stage
        normalize: false
    destinations:
      -
        type: datalayer_event
        category: stage
        action: view
        normalize: true
      -
        type: threshold
        target_key: stage
        target_value: 'stage:discovery'
        storage_key: 'dimensions.stage.stage:orientation'
        threshold_number: 1
        target_location:
          localstorage: localstorage
          cookie: '0'
      -
        type: threshold
        target_key: stage
        target_value: 'stage:validation'
        storage_key: 'dimensions.stage.stage:discovery'
        threshold_number: 2
        target_location:
          localstorage: localstorage
          cookie: '0'
      -
        type: threshold
        target_key: stage
        target_value: 'stage:conversion'
        storage_key: 'dimensions.stage.stage:validation'
        threshold_number: 1
        target_location:
          localstorage: localstorage
          cookie: '0'
      -
        type: threshold
        target_key: stage
        target_value: 'stage:continue'
        storage_key: 'dimensions.stage.stage:conversion'
        threshold_number: 2
        target_location:
          localstorage: localstorage
          cookie: '0'
      -
        type: threshold
        target_key: stage
        target_value: 'stage:continue'
        storage_key: 'dimensions.stage.stage:converted'
        threshold_number: 1
        target_location:
          localstorage: localstorage
          cookie: '0'
  styxkey_recombee_userid:
    name: styxkey_recombee_userid
    label: 'STYXKEY Recombee UserId'
    weight: 12
    status: true
    description: 'Copy RecombeeUserId cookie to STYXKEY_RecombeeUserId to support cookie reading on pantheon platform'
    deferred: false
    sources:
      -
        type: cookie
        name: RecombeeUserId
    processors:
      -
        type: store
        storage_key: RecombeeUserId
        ttl: 0
    destinations:
      -
        type: copy
        target_key: STYXKEY_RecombeeUserId
        remove_empty: true
        storage_key: store.RecombeeUserId.value
        stringify: false
        target_location:
          localstorage: '0'
          cookie: cookie
  convivial_enricher_clientid:
    name: convivial_enricher_clientid
    label: 'Convivial Enricher ClientId'
    weight: 13
    status: true
    description: ''
    deferred: false
    sources:
      -
        type: cookie
        name: convivial_enricher_ConvivialEnricherClientId
    processors:
      -
        type: store
        storage_key: convivial_enricher_clientid
        ttl: 0
    destinations:
      -
        type: copy
        target_key: ConvivialProfilerClientId
        remove_empty: false
        storage_key: store.convivial_enricher_clientid.value
        target_location:
          localstorage: '0'
          cookie: cookie
      -
        type: copy
        target_key: RecombeeUserId
        remove_empty: false
        storage_key: store.convivial_enricher_clientid.value
        target_location:
          localstorage: '0'
          cookie: cookie
  newsletter_signup_form:
    name: newsletter_signup_form
    label: 'Newsletter signup form'
    weight: 14
    status: true
    description: ''
    deferred: false
    sources: {  }
    processors: {  }
    destinations:
      -
        type: formfiller
        form_selector: .newsletter-signup-form
        fields_selector:
          - crm_signup_topic|topic_affinity
          - crm_signup_audience|audience_affinity
          - crm_signup_visits|visits
          - crm_signup_country|location_country
          - crm_signup_city|location_city
        storage_source:
          localstorage: localstorage
          cookie: '0'
  convivial_enricher_cookies_remove:
    name: convivial_enricher_cookies_remove
    label: 'Convivial enricher cookies remove'
    weight: 15
    status: true
    description: 'Remove convivial_enricher_convivial_demo_topic, convivial_enricher_convivial_demo_audience, convivial_enricher_convivial_demo_campaign cookies.'
    deferred: false
    sources: {  }
    processors: {  }
    destinations:
      -
        type: remove
        storage_keys:
          - store.topic_crm.value
          - store.audience_crm.value
          - store.campaign_crm.value
        static_values:
          - convivial_enricher_convivial_demo_topic
          - convivial_enricher_convivial_demo_audience
          - convivial_enricher_convivial_demo_campaign
        target_location:
          localstorage: '0'
          cookie: cookie
  office_hours:
    name: office_hours
    label: 'Office hours'
    weight: 0
    status: true
    description: ''
    deferred: false
    sources: {  }
    processors: {  }
    destinations:
      -
        type: officehours
        target_key: office_open
        normal_start: '2023-04-03'
        normal_end: '2023-10-01'
        normal_offset: '+10'
        daylight_saving_start: '2023-10-02'
        daylight_saving_end: '2024-04-02'
        daylight_saving_offset: '+11'
        office_times:
          -
            day: 0
            start: 0
            close: 0
          -
            day: 1
            start: 9
            close: 17
          -
            day: 2
            start: 9
            close: 17
          -
            day: 3
            start: 9
            close: 17
          -
            day: 4
            start: 9
            close: 17
          -
            day: 5
            start: 9
            close: 17
          -
            day: 6
            start: 0
            close: 0
        target_location:
          localstorage: localstorage
          cookie: '0'
  page_helpful:
    name: page_helpful
    label: 'Page helpful'
    weight: 0
    status: true
    description: ''
    deferred: false
    sources: {  }
    processors: {  }
    destinations:
      -
        type: formtracker
        form_selector: .webform-submission-is-helpful-form
        field_name: is_helpful
        event_action: formsubmit
        event_category: page_helpful
visibility:
  'entity_bundle:node':
    id: 'entity_bundle:node'
    negate: false
    context_mapping:
      node: '@node.node_route_context:node'
    bundles: {  }
  request_path:
    id: request_path
    negate: false
    pages: ''
  user_role:
    id: user_role
    negate: false
    context_mapping:
      user: '@user.current_user_context:current_user'
    roles: {  }
